<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> • foehnix</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">foehnix</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/foehnix.html">Getting started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/foehnix.html">Foehnix Demo</a>
    </li>
    <li>
      <a href="../articles/simulation.html">Simulation Examples</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/mixedmodel.html">Statistical Model</a>
    </li>
    <li>
      <a href="../articles/logisticregression.html">Logistic Regression (IWLS)</a>
    </li>
    <li>
      <a href="../articles/advanced_simulation.html">Censoring and Truncation</a>
    </li>
    <li>
      <a href="../articles/families.html">foehnix Families</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/retostauffer/Rfoehnix">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1></h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/retostauffer/Rfoehnix/blob/master/../vignettes/foehnix.Rmd"><code>../vignettes/foehnix.Rmd</code></a></small>
      <div class="hidden name"><code>foehnix.Rmd</code></div>

    </div>

    
    
<div id="foehnix-demo" class="section level2">
<h2 class="hasAnchor">
<a href="#foehnix-demo" class="anchor"></a>Foehnix Demo</h2>
<p>This page shows a <em>real world</em> demo of the automated foehn classification method <strong>foehnix</strong> based on meteorological observations from two sites in Tyrol, Austria. <a href="reference/ellboegen.html">One station</a> is located in the Brenner valley south of Innsbruck on 1080 meters above mean sea level, the <a href="reference/sattelberg.html">second station</a> is located close to the main alpine ridge on 2107 meters above mean sea level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"ellboegen"</span>); <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"sattelberg"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(ellboegen);   <span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(sattelberg)</code></pre></div>
<pre><code>##    timestamp  dd  ff     p rh    t
## 1 1263805200 338 1.2 899.8 75 -0.9
## 2 1263808800  18 0.1 899.9 66  0.2
## 3 1263812400 344 0.8 899.1 63  0.7
## 4 1263816000 303 2.4 898.8 60  0.7
## 5 1263819600 292 2.8 898.5 57  1.9
## 6 1263823200 316 1.6 898.6 70  0.3</code></pre>
<pre><code>##    timestamp  dd  ff     p rh    t
## 1 1263805200   3 5.6 787.7 93 -8.7
## 2 1263808800 344 5.3 787.9 90 -8.0
## 3 1263812400 360 6.0 787.3 80 -7.7
## 4 1263816000 357 6.5 786.8 77 -7.3
## 5 1263819600 358 8.7 786.6 78 -7.2
## 6 1263823200 352 7.6 786.8 80 -7.2</code></pre>
<p>This example shows how to perform foehn classification for <a href="reference/ellboegen.html">Ellboegen</a> using the information of the <a href="reference/sattelberg.html">Sattelberg</a> station as additional source of information. The <a href="reference/sattelberg.html">Sattelberg</a> station is located south of <a href="reference/ellboegen.html">Ellboegen</a> close to the alpine crest and thus, during foehn events, measuring the upstream air mass descending down on the north side of the Alps.</p>
<div id="south-foehn-classification-for-ellboegen" class="section level3">
<h3 class="hasAnchor">
<a href="#south-foehn-classification-for-ellboegen" class="anchor"></a>South Foehn Classification for Ellboegen</h3>
<p>To perform the classification we first of all have to prepare our data sets. <code><a href="../reference/foehnix.html">foehnix(...)</a></code> expects the input to be of class <code>zoo</code> (zoo time series object; based on the  <code>zoo</code> package). Thus, after loading our example data sets, we first have to convert the <code>data.frame</code>s into valid <code>zoo</code> objects:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Loading observations (data.frame), convert to zoo</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"ellboegen"</span>, <span class="dt">package =</span> <span class="st">"foehnix"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(<span class="st">"sattelberg"</span>, <span class="dt">package =</span> <span class="st">"foehnix"</span>)
timefun    &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/as.POSIXlt">as.POSIXct</a></span>(x,  <span class="dt">origin =</span> <span class="st">"1970-01-01"</span>, <span class="dt">tz =</span> <span class="st">"UTC"</span>)
ellboegen  &lt;-<span class="st"> </span><span class="kw">zoo</span>(ellboegen[,<span class="op">-</span><span class="dv">1</span>],  <span class="kw">timefun</span>(ellboegen<span class="op">$</span>timestamp))
sattelberg &lt;-<span class="st"> </span><span class="kw">zoo</span>(sattelberg[,<span class="op">-</span><span class="dv">1</span>], <span class="kw">timefun</span>(sattelberg<span class="op">$</span>timestamp))</code></pre></div>
<p>As we want to use information from both stations: rename the variables of the <code>sattelberg</code> object and combine the two data sets into one <code>zoo</code> object called <code>data</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Modify sattelberg variable names (crest_ identifies Sattelberg</span>
<span class="co"># observations, our crest station) and combine both data sets.</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(sattelberg) &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">"crest_"</span>, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/names">names</a></span>(sattelberg))
data &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/merge">merge</a></span>(ellboegen, sattelberg)

<span class="co"># </span><span class="al">NOTE</span><span class="co">: for demonstration purpose we split the data set into</span>
<span class="co"># two pieces: a training and a test data set. </span>
<span class="co"># The training data set is used to estimate the mixture model, the</span>
<span class="co"># test data set will be used for "predictions" (see "Predictions"</span>
<span class="co"># section of this file).</span>
train &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(data, <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/nrow">nrow</a></span>(data) <span class="op">-</span><span class="st"> </span><span class="dv">10</span>)
test  &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(data, <span class="dv">10</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rm">rm</a></span>(data) <span class="co"># Delete 'data'</span></code></pre></div>
<p>In addition we are calculating the potential temperature difference between the two sites using a dry adiabatic lapse rate of one 10 degrees Celsius per 1000 meters. The difference in altitude between the two stations is 1027 meters which yields:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Dry adiabatic temperature difference between </span>
<span class="co"># Sattelberg (data$crest_t) and Ellboegen (data$t) corrected by</span>
<span class="co"># 1027/10 degrees.</span>
train<span class="op">$</span>diff_t &lt;-<span class="st"> </span>train<span class="op">$</span>crest_t <span class="op">+</span><span class="st"> </span><span class="fl">10.27</span> <span class="op">-</span><span class="st"> </span>train<span class="op">$</span>t</code></pre></div>
<p>South foehn flow at the valley station in <a href="reference/ellboegen.html">Ellboegen</a> has a wind direction of about 133 degrees. We are using a (relatively weak) wind direction filter with a wind sector of +/-90 degrees around 133 degrees. For the classification only observations/times are used where the corresponding wind direction (<code>dd</code>) lies within the wind sector <code>&gt;=43</code> and <code>&lt;= 223</code> (180 degrees sector). In addition we can make use of the information provided by the crest station (<a href="reference/sattelberg.html">Sattelberg</a>) in several ways:</p>
<ol style="list-style-type: decimal">
<li>We use the temperature difference between the two stations as main variable for the classification (<code>diff_t</code>).</li>
<li>define wind sector filter at the target station (<a href="reference/ellboegen.html">Ellboegen</a>). Only use observations with a wind direction (<code>dd</code>) inside the wind sector of <code>&gt;=43</code> and <code>&lt;=223</code> degrees for classification (<code>dd = c(43, 223)</code>).</li>
<li>specify a second filter such that only observations are used for classification where the crest station shows a southerly flow (wind direction within <code>&gt;= 90</code> and <code>&lt;= 270</code>, <code>sat_dd = c(90, 270)</code>).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Specify our wind filter rule(s)</span>
filter &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/list">list</a></span>(<span class="dt">dd =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">43</span>, <span class="dv">223</span>), <span class="dt">crest_dd =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">90</span>, <span class="dv">270</span>))

<span class="co"># Estimate the mixture model for automated foehn classification</span>
mod &lt;-<span class="st"> </span><span class="kw"><a href="../reference/foehnix.html">foehnix</a></span>(diff_t <span class="op">~</span><span class="st"> </span>ff, <span class="dt">data =</span> train, <span class="dt">filter =</span> filter, <span class="dt">switch =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
</div>
<div id="check-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#check-the-model" class="anchor"></a>Check the Model</h2>
<p>A set of S3 methods for object of class <code>foehnix</code> are available, This includes methods to access information criteria, methods to check the estimated model (model settings), methods to return the estimated coefficients and probabilities, and some default plots for model assessment.</p>
<p>Let’s check our demo model <code>mod</code> estimated above:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Information criteria</span>
<span class="co"># logLik: final log-likelihood sum of the model</span>
<span class="co"># edf: effective degrees of freedom</span>
<span class="co"># AIC: Akaike information criterion</span>
<span class="co"># BIC: Bayesian information criterion</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/logLik">logLik</a></span>(mod), <span class="kw"><a href="../reference/edf.html">edf</a></span>(mod), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/AIC">AIC</a></span>(mod), <span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/AIC">BIC</a></span>(mod))</code></pre></div>
<pre><code>##    loglik       edf       AIC       BIC 
## -40634.65      6.00  81281.30  81327.96</code></pre>
<p>The <code>print</code> and <code>summary</code> methods show some information about the model such as number of observations used for the classification, the filter and its effect, and the corresponding information criteria.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(mod)</code></pre></div>
<pre><code>## 
## Call: foehnix(formula = diff_t ~ ff, data = train, switch = TRUE, filter = filter)
## 
## Number of observations (total)    71346
## Removed due to missing values      4660 (6.5 percent)
## Outside defined wind sector       49066 (68.8 percent)
## Used for classification           17620 (24.7 percent)
## 
## Climatological foehn occurance 12.27 percent (on n = 66686)
## Mean foehn probability 12.13 percent (on n = 66686)
## 
## Log-likelihood: -40634.7, 6 effective degrees of freedom
## Corresponding AIC = 81281.3, BIC = 81328.0
## Time required for model estimation: 1.4 seconds</code></pre>
<p>The <code>coef</code> or <code>coefficients</code> method returns the estimated coefficients.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(mod)</code></pre></div>
<pre><code>## Coefficients of foehnix model
## Model formula:           diff_t ~ ff
## foehnix family of class: Gaussian
## 
## Coefficients
##         mu1      sigma1         mu2      sigma2 (Intercept)          ff 
##    5.988051    2.758007    1.287428    1.239425   -5.975843    1.011069</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">c &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(mod)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(c[<span class="st">"mu1"</span>])</code></pre></div>
<pre><code>##      mu1 
## 5.988051</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(c[<span class="st">"mu2"</span>])</code></pre></div>
<pre><code>##      mu2 
## 1.287428</code></pre>
<p>The method <code>plot</code> provides a set of model assessment plots. Different types are available, if no <code>which</code> argument is set all will be shown one after another.</p>
<p><code>which = "loglik"</code> shows the log-likelihood path of the two components of the model (the part for the two components of the mixture model plus the one of the concomitant model) plus the full likelihood path. The x-axis shows the log-iterations of the EM algorithm (see <a href="articles/mixedmodel.html">statistical models</a> for more details). Increasing values indicate positive log-likelihood contributions (improvement of the model).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mod, <span class="dt">which =</span> <span class="st">"loglik"</span>, <span class="dt">log =</span> F)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-10-1.png" width="960"></p>
<p><code>which = "loglikcontribution"</code> shows the same information as <code>which = "loglik"</code> but with respect to the log-likelihood of the initial parameters. Increasing values indicate positive log-likelihood contributions (improvement of the model).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mod, <span class="dt">which =</span> <span class="st">"loglikcontribution"</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-11-1.png" width="960"></p>
<p>Similar to the plots above we can also check the paths of the coefficients trough the iterations of the EM algorithm with <code>which = "coef"</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mod, <span class="dt">which =</span> <span class="st">"coef"</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-12-1.png" width="960"></p>
<p>Last but not least the <code>which = "hist"</code> plot shows the conditional histograms of the two clusters. Two histograms are shown given the main covariate of the <code>foehnix</code> mixture model, in this case (model <code>mod</code>) it is <code>delta_t</code>, the potential temperature difference between the valley station <a href="reference/ellboegen.html">Ellboegen</a> and the crest station <a href="reference/sattelberg.html">Sattelberg</a>. The left panel corresponds to the “no foehn” component or cluster, the right one to the “foehn” component. If a <code>filter</code> rule is used: only the data which have been used for classification will be shown. Observations with a higher probability to be in the left component are sown left, observations with a higher probability to be a member of the second component are shown right. On top (line) the estimated density of the two components is shown.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(mod, <span class="dt">which =</span> <span class="st">"hist"</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-13-1.png" width="960"></p>
<p>Fitted probabilities (the probabilities obtained by the model based on the training data set) can be accessed by calling <code>fitted</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Class of fitted probabilities is a zoo object</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/class">class</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod))</code></pre></div>
<pre><code>## [1] "zoo"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/summary">summary</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod))</code></pre></div>
<pre><code>##      Index                      fitted(mod)   
##  Min.   :2010-01-18 09:00:00   Min.   :0.000  
##  1st Qu.:2012-01-31 13:15:00   1st Qu.:0.000  
##  Median :2014-02-12 17:30:00   Median :0.000  
##  Mean   :2014-02-12 17:30:00   Mean   :0.121  
##  3rd Qu.:2016-02-25 21:45:00   3rd Qu.:0.000  
##  Max.   :2018-03-10 02:00:00   Max.   :1.000  
##                                NA's   :4660</code></pre>
<p>The method let’s you access the fitted probabilities (<code>which = "probability"</code>), a flag which comes with the fitted values (<code>which = "flag"</code>), or both (<code>which = "both"</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Probabilities only</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod, <span class="dt">which =</span> <span class="st">"probability"</span>))</code></pre></div>
<pre><code>## 2018-03-09 21:00:00 2018-03-09 22:00:00 2018-03-09 23:00:00 
##           0.9997443           0.9994805           0.9994805 
## 2018-03-10 00:00:00 2018-03-10 01:00:00 2018-03-10 02:00:00 
##           0.9999128           0.9997484           0.9984492</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Flag only</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod, <span class="dt">which =</span> <span class="st">"flag"</span>))</code></pre></div>
<pre><code>## 2018-03-09 21:00:00 2018-03-09 22:00:00 2018-03-09 23:00:00 
##                   1                   1                   1 
## 2018-03-10 00:00:00 2018-03-10 01:00:00 2018-03-10 02:00:00 
##                   1                   1                   1</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Both</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod, <span class="dt">which =</span> <span class="st">"both"</span>))</code></pre></div>
<pre><code>##                          prob flag
## 2018-03-09 21:00:00 0.9997443    1
## 2018-03-09 22:00:00 0.9994805    1
## 2018-03-09 23:00:00 0.9994805    1
## 2018-03-10 00:00:00 0.9999128    1
## 2018-03-10 01:00:00 0.9997484    1
## 2018-03-10 02:00:00 0.9984492    1</code></pre>
<p>Explanation of the flag: * <code>NA</code> if we have had missing data (missing covariates, or missing data to apply the <code>filter</code> rules provided when calling <code>foehnix</code>). * <code>0</code> if observations have been outside the defined <code>filter</code>, not used for classification and thus the probability has been set to <code>0</code>. * <code>1</code> if observations have been used for classification with the corresponding estimated probability.</p>
</div>
<div id="conditional-and-unconditional-wind-rose-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#conditional-and-unconditional-wind-rose-plots" class="anchor"></a>Conditional and Unconditional Wind Rose Plots</h2>
<p>In addition, <a href="reference/windrose.foehnix.html">windrose</a> proides a convenient function to plot wind roses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/windrose.html">windrose</a></span>(mod, <span class="dt">mfcol =</span> <span class="dv">3</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-16-1.png" width="1152"></p>
<p>The individual plots can also be plotted separately:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/windrose.html">windrose</a></span>(mod, <span class="dt">which =</span> <span class="st">"foehn"</span>, <span class="dt">mfcol =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-17-1.png" width="1152"></p>
<p>One type shows the density function (<code>type = "density"</code>), the other one a 2-D histogram (<code>type = "histogram"</code>). The argument <code>which</code> allows to plot the unconditional windrose (<code>which = "unconditional"</code>), the ‘no foehn event’ windrose (<code>which = "nofoehn"</code>) which shows only observations where the classification gives a probability of foehn below <code>0.5</code>, and a wind rose for ‘foehn’ events where the classification returned a probability of <code>&gt;= 0.5</code>.</p>
</div>
<div id="hovmoller-diagrams" class="section level2">
<h2 class="hasAnchor">
<a href="#hovmoller-diagrams" class="anchor"></a>Hovmöller Diagrams</h2>
<p>The <code>image</code> method applied to <code>foehnix</code> objects allows to plot Hovmöller diagrams with a set of options. Some of the features are:</p>
<ul>
<li>Aggregate the data along the time-of-the-day axis (y-axis) as well as along the time-of-the-hear axis (x-axis).</li>
<li>Add contour lines on top of the data.</li>
<li>Beside the “default” aggregation functions custom aggregation functions can be used. Examples:
<ul>
<li>
<code>FUN = "mean"</code>: aggregates mean foehn probability.</li>
<li>`FUN = “occ”: occurrence of foehn events (events with a probability &gt;= 0.5).</li>
<li>`FUN = “noocc”: occurrence of non-foehn events (events with a probability &lt; 0.5).</li>
<li>`FUN = “freq”: frequency of foehn events.</li>
<li>
<code>FUN = function(x) sum(x &gt; 0.8, na.rm = TRUE)</code>: an example of a custom function, in this case the occurrence of events with a probability larger than 0.8.</li>
</ul>
</li>
</ul>
<p><strong>Example 1</strong>: Default plot, no aggregation on the time axis (<code>deltat = NULL</code>; takes increments of the underlying data), weekly aggregation along the time of the year axis (<code>deltad = 7L</code>), the frequency (<code>FUN = "freq"</code>) is plotted without contours.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(mod, <span class="dt">FUN =</span> <span class="st">"freq"</span>)</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-18-1.png" width="1152"></p>
<p><strong>Example 2</strong>: Aggregated to three-hourly intervals (<code>deltat = 3600 * 3</code>), two-week mean values (<code>deltad = 14L</code>), occurrance of foehn (<code>FUN = "occ"</code>), with custom colors and contours (without labels).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">col &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/rev">rev</a></span>(colorspace<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/colorspace/topics/hcl_palettes">sequential_hcl</a></span>(<span class="dv">51</span>, <span class="dt">h =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="op">-</span><span class="dv">50</span>, <span class="dv">120</span>), <span class="dt">c. =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">80</span>, <span class="dv">10</span>)))
<span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/image">image</a></span>(mod, <span class="dt">FUN =</span> <span class="st">"occ"</span>, <span class="dt">col =</span> col,
      <span class="dt">deltat =</span> <span class="dv">3</span> <span class="op">*</span><span class="st"> </span><span class="dv">3600</span>, <span class="dt">deltad =</span> 14L,
      <span class="dt">contours =</span> <span class="ot">TRUE</span>, <span class="dt">contour.col =</span> <span class="st">"white"</span>, <span class="dt">lwd =</span> <span class="dv">2</span>, <span class="dt">drawlabels =</span> <span class="ot">FALSE</span>,
      <span class="dt">main =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">"Hovmoeller Diagram, Occurrence of Foehn"</span>,
                   <span class="st">"2-Weekly/3-Hourly Sums"</span>, <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>))</code></pre></div>
<p><img src="foehnix_files/figure-html/unnamed-chunk-19-1.png" width="1152"></p>
</div>
<div id="predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#predictions" class="anchor"></a>Predictions</h2>
<p>A last important method is <code>predict</code>. The term predict refers to statistical prediction, applying a statistical model to a data set which has never been seen by the model (not included in the training data set).</p>
<p>As <code>foehnix</code> is a statistical classification method a prediction in this context is not a forecast (like a weather forecast), but a classification to new data. This can, for example, be used to retrieve foehn probabilities for new observation in an operational context.</p>
<p>Assume we have estimated a <code>foehnix</code> mixture model and a set of new observations from our two stations (<a href="reference/ellboegen.html">Ellboegen</a> and <a href="reference/sattelberg.htlm">Sattelberg</a>) have become available. We would like to get foehn probabilities this new data set. Luckily we put aside 10 observations earlier (the <code>test</code> data set):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Calculate potential temperature difference (as we did above)</span>
test<span class="op">$</span>diff_t &lt;-<span class="st"> </span>test<span class="op">$</span>crest_t <span class="op">+</span><span class="st"> </span><span class="fl">10.27</span> <span class="op">-</span><span class="st"> </span>test<span class="op">$</span>t
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(test)</code></pre></div>
<pre><code>##                      dd   ff     p rh   t crest_dd crest_ff crest_p
## 2018-03-10 03:00:00 136  8.2 888.2 58 6.2      169     15.8   779.8
## 2018-03-10 04:00:00 145  9.1 887.6 57 6.1      181     15.9   779.7
## 2018-03-10 05:00:00 134  8.8 887.5 59 6.0      173     14.7   779.8
## 2018-03-10 06:00:00 122  9.4 887.4 58 6.0      174     15.5   779.5
## 2018-03-10 07:00:00 135 10.3 887.5 56 6.4      183     15.7   779.5
## 2018-03-10 08:00:00 145 12.4 887.4 55 6.8      164     16.1   779.6
## 2018-03-10 09:00:00 136 11.8 887.2 55 7.1      170     19.1   779.0
## 2018-03-10 10:00:00 134 13.9 887.7 56 7.0      169     16.8   779.8
## 2018-03-10 11:00:00 115  8.9 888.2 54 7.3      176     15.2   780.5
## 2018-03-10 12:00:00 133  9.1 888.3 59 6.9      176     17.3   779.9
##                     crest_rh crest_t diff_t
## 2018-03-10 03:00:00      100    -3.3   0.77
## 2018-03-10 04:00:00      100    -3.4   0.77
## 2018-03-10 05:00:00      100    -3.5   0.77
## 2018-03-10 06:00:00      100    -3.5   0.77
## 2018-03-10 07:00:00      100    -3.3   0.57
## 2018-03-10 08:00:00       98    -3.0   0.47
## 2018-03-10 09:00:00       98    -2.8   0.37
## 2018-03-10 10:00:00       98    -2.8   0.47
## 2018-03-10 11:00:00       96    -2.0   0.97
## 2018-03-10 12:00:00       95    -1.7   1.67</code></pre>
<p>Given our model we can not perform the classification on this new data set which has not been used for training the <code>foehnix</code> mixture model by calling:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/predict">predict</a></span>(mod, <span class="dt">newdata =</span> test)</code></pre></div>
<pre><code>## 
## Foehnix Filter Object:
## Call: foehnix_filter(x = newdata, filter = object$filter)
## Total data set length:                10
## The good (within filter):             10 (100.0 percent)
## The bad (outside filter):              0 ( 0.0 percent)
## The ugly (NA; missing values):         0 ( 0.0 percent)</code></pre>
<pre><code>##                          prob flag
## 2018-03-10 03:00:00 0.9919772    1
## 2018-03-10 04:00:00 0.9967549    1
## 2018-03-10 05:00:00 0.9956101    1
## 2018-03-10 06:00:00 0.9976019    1
## 2018-03-10 07:00:00 0.9990890    1
## 2018-03-10 08:00:00 0.9998933    1
## 2018-03-10 09:00:00 0.9998075    1
## 2018-03-10 10:00:00 0.9999766    1
## 2018-03-10 11:00:00 0.9957004    1
## 2018-03-10 12:00:00 0.9945286    1</code></pre>
<p>For demonstration: we would have become the same (roughly the same, as a slightly different training data set is used) if we would re-estimate the model based on the whole data set (<code>train</code> and <code>test</code> combined) and check the estimated probabilities of the last 10 entries, the very same times we have put aside as our <code>test</code> data set:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mod2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/foehnix.html">foehnix</a></span>(diff_t <span class="op">~</span><span class="st"> </span>ff, <span class="dt">data =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cbind">rbind</a></span>(train,test),
                <span class="dt">filter =</span> filter, <span class="dt">switch =</span> <span class="ot">TRUE</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/print">print</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">tail</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(mod2, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>), <span class="dv">10</span>))</code></pre></div>
<pre><code>##                          prob flag
## 2018-03-10 03:00:00 0.9919592    1
## 2018-03-10 04:00:00 0.9967463    1
## 2018-03-10 05:00:00 0.9955990    1
## 2018-03-10 06:00:00 0.9975952    1
## 2018-03-10 07:00:00 0.9990861    1
## 2018-03-10 08:00:00 0.9998928    1
## 2018-03-10 09:00:00 0.9998068    1
## 2018-03-10 10:00:00 0.9999765    1
## 2018-03-10 11:00:00 0.9956891    1
## 2018-03-10 12:00:00 0.9945102    1</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#foehnix-demo">Foehnix Demo</a></li>
      <li><a href="#check-the-model">Check the Model</a></li>
      <li><a href="#conditional-and-unconditional-wind-rose-plots">Conditional and Unconditional Wind Rose Plots</a></li>
      <li><a href="#hovmoller-diagrams">Hovmöller Diagrams</a></li>
      <li><a href="#predictions">Predictions</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Reto Stauffer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
